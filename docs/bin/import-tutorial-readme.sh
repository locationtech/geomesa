#!/bin/bash
#
# Import several README.md files from the GeoMesa tutorials distribution,
# using ``pandoc`` to convert Markdown to RST.
#
# ----------------------------------------------------------------------
# WARNING: This is not completely automated. You will almost certainly
# have to hand-edit the files after this import!
# ----------------------------------------------------------------------

# Upate for your system
GEOMESA_PATH=/opt/devel/src/geomesa
TUTORIAL_PATH=/opt/devel/src/geomesa-tutorials
TUTORIALS="
geomesa-examples-authorizations
geomesa-examples-gdelt
geomesa-examples-transformations
geomesa-quickstart-accumulo
geomesa-quickstart-kafka
geomesa-quickstart-storm
"

#
for tutorial in $TUTORIALS ; do
    echo "## $tutorial:"

    # copy the README.md file
    text_src=$TUTORIAL_PATH/${tutorial}/README.md
    text_dst=$GEOMESA_PATH/docs/tutorials/${tutorial}.rst
    echo "Converting $text_src => $text_dst"
    pandoc -i $text_src -o $text_dst

    # copy the assets too, if they exist
    asset_src=$TUTORIAL_PATH/assets/${tutorial}
    asset_dst=$GEOMESA_PATH/docs/tutorials/_static/${tutorial}
    if [ -d $asset_src ] ; then
        echo "Copying $asset_src/* => $asset_dst"
	    mkdir -p $asset_dst
	    cp $asset_src/* $asset_dst
    fi

    # fix links and bad RST generated by pandoc
    echo "Fixing links and bad RST"
    sed -i -e 's/.. code::/.. code-block::/' $text_dst
    sed -i -e 's!../assets/!_static/!' $text_dst
done
